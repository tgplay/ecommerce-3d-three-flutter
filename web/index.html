<!DOCTYPE html>
<html>
  <head>
    <base href="$FLUTTER_BASE_HREF">
    <meta charset="UTF-8" />
    <meta content="IE=Edge" http-equiv="X-UA-Compatible" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>E-commerce 3D</title>

    <style>
      html, body { 
        margin: 0; 
        padding: 0; 
        width: 100%; 
        height: 100%; 
        overflow: hidden;
        background: #fff;
      }
      
      /* Three.js OCULTO por padrão */
      #three-host { 
        position: fixed; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        z-index: -1;  /* IMPORTANTE: z-index negativo */
        pointer-events: none;
        visibility: hidden;
      }

      /* Quando ativar a classe "three-active", mostrar */
      #three-host.three-active {
        z-index: 999999;
        pointer-events: auto;
        visibility: visible;
      }
      
      canvas { 
        display: block; 
      }

      flt-glass-pane {
        display: none !important;
      }

      #debug {
        position: fixed;
        bottom: 10px;
        left: 10px;
        background: rgba(0,0,0,0.9);
        color: #0f0;
        font-family: monospace;
        font-size: 11px;
        padding: 10px;
        max-width: 350px;
        z-index: 1000000;
        overflow: auto;
        max-height: 300px;
        display: none;  /* Debug oculto por padrão */
      }

      #debug.debug-active {
        display: block;
      }
    </style>
  </head>

  <body>
    <div id="three-host"></div>
    <div id="debug"></div>

    <script>
      const debugLog = document.getElementById('debug');
      window.debug = function(msg) {
        console.log(msg);
        debugLog.innerHTML += msg + '<br/>';
      };
      debug('[DEBUG] Iniciando...');

      // Função para ativar/desativar o viewer 3D
      window.toggle3DViewer = function(active) {
        const host = document.getElementById('three-host');
        const debug = document.getElementById('debug');
        if (active) {
          host.classList.add('three-active');
          debug.classList.add('debug-active');
        } else {
          host.classList.remove('three-active');
          debug.classList.remove('debug-active');
        }
      };
    </script>

    <!-- ImportMap para Three.js ESM -->
    <script type="importmap">
    {
      "imports": {
        "three": "https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.module.js",
        "three/addons/controls/OrbitControls.js": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/controls/OrbitControls.js",
        "three/addons/loaders/GLTFLoader.js": "https://cdn.jsdelivr.net/npm/three@0.160.0/examples/jsm/loaders/GLTFLoader.js"
      }
    }
    </script>

    <!-- Three.js viewer como module script -->
    <script type="module" src="three_viewer.js" async></script>

    <!-- Flutter -->
    <script src="flutter_bootstrap.js" async></script>
  </body>
</html>
